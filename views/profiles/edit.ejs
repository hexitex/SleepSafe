<% include ../partials/header %>

   
    <div class="form-style mt-4">
         <h5>Edit <%=user.showName%>'s Profile</h5>
        <form action="/profiles/<%=user._id%>?_method=PUT" method="post">
           <div class="form-group">
               <label for="upload_widget_opener">Profile Image</label>
               <button id="upload_widget_opener" class="btn btn-info full-width" type="button">Upload Image <span class="float-right"><img class="rounded-circle pic-icon" src="<%=user.avatar%>" id="preview"/></span>
               </button>
            </div>
            <div class="form-group">
                 <label for="email">Screen Name</label>
                <input class="form-control" type="text" id="showname" name="user[showName]" value="<%=user.showName%>"placeholder="Email address" required>
            </div>
            <div class="form-group">
                <label for="password">New Password (leave blank to continue with old password)</label>
                <input class="form-control" type="password" name="password" id="password" placeholder="Password">
            </div>
             <div class="form-group">
                 <label for="email">Email Address</label>
                <input class="form-control" type="email" id="email" name="user[email]" value="<%=user.email%>"placeholder="Email address" required>
            </div>
            <div class="form-group">
                <button class="btn btn-lg btn-primary btn-block">Apply Changes</button>
            </div>
            <input type="hidden" id="avatar" name="user[avatar]" value="<%=user.avatar%>">
        </form>
        <a href="/sites">Go Back</a>
    </div>
   
<script src="https://cdnjs.cloudflare.com/ajax/libs/blueimp-file-upload/9.21.0/js/vendor/jquery.ui.widget.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/blueimp-file-upload/9.21.0/js/jquery.iframe-transport.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/blueimp-file-upload/9.21.0/js/jquery.fileupload.min.js"></script>
    
    <script src="https://cdnjs.cloudflare.com/ajax/libs/cloudinary-jquery-file-upload/2.5.0/cloudinary-jquery-file-upload.min.js"></script>
    <script src="//widget.cloudinary.com/global/all.js" type="text/javascript"></script>
<script>
     document.getElementById("upload_widget_opener").addEventListener("click", function() {
    cloudinary.openUploadWidget({ cloud_name: 'hexitex', upload_preset: 'public_avatar'}, 
      function(err, result) { if (err) {
                console.log(err)
            }
            else
            {
                $('#avatar').val(result[0].secure_url);
                $('#preview').attr('src',result[0].thumbnail_url.replace('http:','https:'));
            } 
          
      });
  }, false);
</script>
<% include ../partials/footer %>